<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <title>Карта Екатеринбурга (GitHub Tiles)</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    
    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
    
    <script src="https://unpkg.com/pmtiles@2.11.0/dist/index.js"></script>

    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; background-color: #ffffff; }
        .map-overlay {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 4px;
            font-family: sans-serif;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>

<div id="map"></div>
<div class="map-overlay">
    <strong>Екатеринбург</strong><br>
    Статические тайлы с GitHub Pages
</div>

<script>
    // 1. Добавляем поддержку протокола pmtiles:// в MapLibre
    const protocol = new pmtiles.Protocol();
    maplibregl.addProtocol("pmtiles", protocol.add);

    // 2. Путь к файлу, который создает ваш GitHub Action
    const PMTILES_URL = "ekb.pmtiles"; 

    const map = new maplibregl.Map({
        container: 'map',
        style: {
            version: 8,
            sources: {
                "ekb_source": {
                    type: "vector",
                    url: `pmtiles://${PMTILES_URL}`,
                    attribution: '© <a href="https://openstreetmap.org">OpenStreetMap</a>'
                }
            },
            layers: [
                // Фон (вода/земля)
                {
                    "id": "background",
                    "type": "background",
                    "paint": { "background-color": "#f8f4f0" }
                },
                // Слой зданий (предполагаем, что в GeoJSON были полигоны)
                {
                    "id": "ekb-buildings",
                    "source": "ekb_source",
                    "source-layer": "ekb", // Tippecanoe по умолчанию называет слой именем файла
                    "type": "fill",
                    "paint": {
                        "fill-color": "#d1d1d1",
                        "fill-outline-color": "#9e9e9e",
                        "fill-opacity": 0.8
                    }
                },
                // Слой дорог (линии)
                {
                    "id": "ekb-roads",
                    "source": "ekb_source",
                    "source-layer": "ekb",
                    "type": "line",
                    "paint": {
                        "line-color": "#ffffff",
                        "line-width": 1.5
                    }
                }
            ]
        },
        center: [60.6057, 56.8389], // Центр Екатеринбурга
        zoom: 12
    });

    // Добавляем кнопки навигации
    map.addControl(new maplibregl.NavigationControl());

    // Проверка ошибок
    map.on('error', (e) => {
        console.error("Ошибка карты:", e.error);
    });
</script>

</body>
</html>