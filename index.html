<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Карта Урала (PMTiles)</title>
    <!-- Подключаем MapLibre GL -->
    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
    <!-- Подключаем библиотеку для работы с PMTiles -->
    <script src="https://unpkg.com/pmtiles@2.11.0/dist/index.js"></script>
    
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        .loading {
            position: absolute; top: 10px; right: 10px; z-index: 999;
            background: white; padding: 10px; border-radius: 4px;
            box-shadow: 0 0 10px rgba(0,0,0,0.2); font-family: sans-serif;
        }
    </style>
</head>
<body>

<div id="map"></div>
<div class="loading" id="status">Загрузка тайлов...</div>

<script>
    // Регистрируем протокол pmtiles
    let protocol = new pmtiles.Protocol();
    maplibregl.addProtocol("pmtiles", protocol.tile);

    // Ссылка на последний релиз (GitHub автоматически редиректит на актуальную версию)
    // ЗАМЕНИТЕ 'username' и 'repo-name' на свои данные!
    const PMTILES_URL = "pmtiles://https://github.com/YOUR_USERNAME/YOUR_REPO_NAME/releases/latest/download/ural.pmtiles";

    const map = new maplibregl.Map({
        container: 'map',
        style: {
            version: 8,
            sources: {
                "ural_source": {
                    type: "vector",
                    url: PMTILES_URL,
                }
            },
            layers: [
                {
                    "id": "background",
                    "type": "background",
                    "paint": { "background-color": "#f0f0f0" }
                },
                {
                    "id": "water",
                    "type": "fill",
                    "source": "ural_source",
                    "source-layer": "water",
                    "paint": { "fill-color": "#a0c8f0" }
                },
                {
                    "id": "landuse",
                    "type": "fill",
                    "source": "ural_source",
                    "source-layer": "landuse",
                    "paint": { "fill-color": "#d8e8c8" }
                },
                {
                    "id": "roads",
                    "type": "line",
                    "source": "ural_source",
                    "source-layer": "transportation",
                    "paint": { "line-color": "#ffffff", "line-width": 2 }
                },
                {
                    "id": "place_labels",
                    "type": "symbol",
                    "source": "ural_source",
                    "source-layer": "place",
                    "layout": {
                        "text-field": "{name}",
                        "text-font": ["Noto Sans Regular"],
                        "text-size": 12
                    },
                    "paint": {
                        "text-color": "#333",
                        "text-halo-color": "#fff",
                        "text-halo-width": 1
                    }
                }
            ]
        },
        center: [58.5, 57.5], // Координаты центра Урала
        zoom: 6
    });

    map.on('load', () => {
        document.getElementById('status').innerText = "Карта загружена";
        setTimeout(() => document.getElementById('status').style.display = 'none', 2000);
    });
</script>

</body>
</html>